# SAM 管理器：动态角色卡制作指南 (非程序员版)

欢迎使用 SAM！你可能听说过这个插件很强大，但面对一堆代码感到头大。别担心，**你不需要懂编程**也能做出拥有“真实记忆”和“RPG数值系统”的高级角色卡。

## 第一部分：概念——SAM 是什么？

普通的 AI 像是一个**只有短暂记忆的演员**。它记得最近说了什么，但如果你聊了很久，它就会忘记你是谁，或者忘记你们三天前去过哪里。

**SAM 就像是给这个演员配了一个“后台场记员”和一本“记事本”。**

1.  **数据 (Data/State)**：这是“记事本”。上面写着你的金币数、好感度、当前地点、背包里的道具。AI 可以随时修改上面的数字。
2.  **摘要 (Summary)**：这是“剧情大纲”。当聊天记录太长时，SAM 会自动把旧的对话浓缩成一段话存起来。这样 AI 永远记得很久以前发生的大事，而且不占用短期记忆。
3.  **指令 (Commands)**：这是 AI 对场记员说的话。比如 `@.SET("好感度", 50)`，就是 AI 告诉 SAM：“把好感度改成 50”。

---

## 第二部分：从零开始配置角色卡

要让一张角色卡启用 SAM 功能，你只需要在**世界书 (World Info)** 里添加两个特殊的词条。

### 第一步：创建“激活钥匙”

SAM 插件默认是休眠的，你必须告诉它：“这张卡需要你工作。”

1.  打开你的 SillyTavern **世界书 (World Info)** 面板。
2.  新建一个词条。
3.  **关键步骤**：
    *   在 **注释 (Comment)** 栏填入：`__SAM_IDENTIFIER__`
    *   *注意：是双下划线，必须一字不差。*
4.  **内容 (Content)** 栏：如果你不懂代码，这里留空，或者填入 `{}` 即可。
5.  **启用策略**：取消这个词条，它即使不是绿灯，即使是关闭的，SAM也能读到它。

> ✅ **完成！** 现在当你加载这张卡时，SAM 插件的面板就会亮起绿灯。

### 第二步：设定“初始状态” (可选但推荐)

如果你希望游戏开始时，玩家就有 100 金币，或者好感度初始为 0，你需要设置这个。

1.  在世界书里再新建一个词条。
2.  **词条名称 (Key/Name)** 必须填入：`__SAM_base_data__`
3.  **内容 (Content)** 栏填入初始数据的 JSON 格式。别怕，格式很简单：

```json
{
    "static": {
        "玩家金币": 100,
        "好感度": 0,
        "当前地点": "新手村",
        "背包": ["生锈的剑", "面包"]
    }
}
```

*   **static**: 代表这些是固定的属性。
*   你可以随意把中文换成你想要的属性名。
*   *注意：所有的标点符号必须是英文符号（双引号、冒号、逗号）。*

---

## 第三部分：教 AI 如何使用 SAM (Prompt 写法)

这是最重要的一步。虽然 SAM 准备好了，但 AI 不知道怎么用。你需要在**角色备注 (Character Note)** 或 **深度提示 (Depth Prompt)** 中加入使用说明。

你可以直接复制下面的模板：

```text
[系统指令：启用 SAM 引擎]
你拥有操作剧情数据的权限。请根据剧情发展，在回复的末尾使用以下指令来更新状态：

1. 修改数值或状态：
@.SET("变量名", 新值);
例如：
@.SET("好感度", 10); // 将好感度直接变为10
@.SET("当前地点", "城堡"); // 移动到城堡

2. 增加数值 (加法)：
@.ADD("变量名", 数值);
例如：
@.ADD("好感度", 5); // 好感度增加5点
@.ADD("金币", -20); // 花费20金币

3. 获得物品 (添加到列表)：
@.ADD("背包", "红药水");

[当前状态参考]
请时刻关注最新的 SAM 数据块，如果玩家购买了物品，务必扣除金币并添加物品到背包。不要在回复中用文字描述你在修改数据，直接输出指令即可。
```

---

## 第四部分：实战演示

假设你已经配置好了上面的内容。

**玩家输入**：
> “嘿，漂亮的女士，这朵花送给你。”

**AI (后台思考)**：
> 玩家送花了，好感度应该增加。

**AI 回复**：
> 她的脸红了，微笑着接过了花。“谢谢你，这很美。”
>
> @.ADD("好感度", 5);
> @.ADD("背包", "鲜花");

**SAM 插件的反应**：
*   它会捕捉到 `@.ADD` 指令。
*   它会自动把你后台的“好感度”从 0 变成 5。
*   它会自动把“鲜花”塞进“背包”列表里。
*   **最棒的是**：下次你再问 AI “我刚才送你什么了？”，AI 会去查数据，看到背包里有花，然后回答你。

---

## 第五部分：常见问题 (Q&A)

**Q: 为什么 AI 不执行指令？**
A: 检查两点：
1. 你的 Prompt 里有没有给它范例？AI 也是通过模仿学习的。
2. 世界书里那个 `__SAM_IDENTIFIER__` 的注释写对了吗？

**Q: 我可以直接手动改数据吗？**
A: 可以！在聊天界面打开 SAM 插件面板（通常是一个抽屉按钮），点击 **Data** 标签页。你会看到所有的变量，你可以直接在那里修改数值，然后点“Commit”保存。

**Q: 摘要功能怎么用？**
A: 只要你激活了 SAM，摘要功能默认是开启的。你可以在 **Summary** 标签页看到它自动生成的剧情总结。你不需要操心，它会自动帮你省 Token。

**Q: 正则表达式 (Regex) 是什么？**
A: 如果 AI 输出指令时，指令文字露在外面影响阅读（虽然 SAM 会自动隐藏它们，但有时候会漏），你可以在 SAM 面板的 **Regex** 分页里添加规则来过滤掉它们。对于新手，通常不需要动这个。

---

## 进阶技巧：时间系统

如果你想做一个有昼夜交替的 RPG，SAM 支持时间管理。

在 Prompt 中加入：
`@.TIME("2025-01-01 12:00");` —— 设定绝对时间。
`@.ADD("time", 60);` —— 假设你设定了时间流逝逻辑（这需要更高级的函数配合，新手建议先只玩数值加减）。

---

**总结**

1. **世界书** -> 建个词条，注释写 `__SAM_IDENTIFIER__`。
2. **世界书** -> 建个词条 `__SAM_base_data__` 写初始属性 (JSON)。
3. **Prompt** -> 告诉 AI 怎么用 `@.SET` 和 `@.ADD`。
4. **开始玩！**
