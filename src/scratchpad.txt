TavernHelper.getVariables({'type':'characters'})
await TavernHelper.replaceVariables({神乐光: {好感度: 5, 认知度: 0}}, {type: 'characters'});

we must do character settings here.
idea: 
App.js takes care of the custom function setting. App.js sets custom function to character variables.
Then script gets the functions via the character variables!



// rethink: Do we really need that?
// the answer is really NO.
// base case: use SAM V4 script (no extension) -> works
// extended case: use the extension, enables auto memory and state manip -> better, still works
// therefore it is better if we refactor the script and make the plugin purely for auto memory and state manipulation
// it is actually not very preferred to keep the updater and the script together
// because there are people who want to use other memory extensions and we will let them!


// new arch:

// splitted sources: 1. script 2. ext
// splitted data sources: 1. chat (perm) 2. vars (temp)
// event is just a string. We support sending "EVENT" instead of something in event_types.
// this is completely fine.
// use await eventEmit for script.
// use the other method for ext.
/*
normal gameplay:

script - begin
script - AITime
script - finish
script gets the SAM_data current
script processes @.commands from AI
script writes new SAM_data to chat
script broadcast event: SAM_DATA_UPDATED
ext receives event, updates its display

Summary:

for 20 runs later... or some preset checkpoint time
There is going to be a race condition and this is guaranteed.
AI might be running, but ext is also running AI summary. 
If ext finishes earlier than AI, it will update SAM data FIRST, which is bad behavior.

ext - sends SAM_SUMMARY_BEGIN
ext - AITime
ext - sends SAM_SUMMARY_END
ext checks script's window function to see if it is idle or not. If not, wait.
Or, ext broadcasts SAM_ASK_FOR_IDLE. script waits 0.05s, then broadcasts SAM_IS_IDLE or SAM_IS_NOT_IDLE after receiving.
ext may choose to re-ask this question every 1s. 1s is fairly long in computer time.
ext gets SAM_data
ext writes SAM_data.response_summary
ext writes new SAM_data to chat
ext updates its own display

Edit vars/response_summary:
ext - commit button pressed
ext - if json invalid, return -1 (fail)
ext checks script's window function to see if it is idle or not. If not, wait.
ext writes it to chat.
ext writes it to vars.
ext broadcasts SAM_DATA_UPDATED
script gets the event
script triggers rerender on Tavernhelper (Or, a set chat messages with itself. This also re-renders)


Function/base Setting updates:
ext - commit button pressed
ext - if function invalid, return -1 (fail)
ext writes it to character variables. This makes it persist with the character
ext broadcasts SAM_FUNCTION_UPDATED
script gets the functions and stores them in const functions.

Note that no setting is being stored in global settings. This is expected - different cards 
may require different settings.
SAM extension is only an "editor" and summarizer.


*/